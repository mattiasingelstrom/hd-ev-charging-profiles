# Station-Level Charging Demand Profiles for Heavy-Duty Electric Trucks

[![DOI](https://img.shields.io/badge/DOI-10.5281%2Fzenodo.XXXXXXX-blue)](https://doi.org/10.5281/zenodo.XXXXXXX)
[![License: MIT](https://img.shields.io/badge/Code-MIT-green.svg)](LICENSE)
[![License: CC BY 4.0](https://img.shields.io/badge/Data-CC%20BY%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by/4.0/)

---

## Overview

This repository contains hourly power-demand profiles for electric heavy-duty truck charging in the Skåne region of southern Sweden, derived from an agent-based transport simulation using [MATSim](https://www.matsim.org/).
The profiles cover two charging scenarios — **public en-route fast charging** and **optimised overnight depot charging** — and are provided both as fleet-size-independent normalised shapes and as absolute MW curves with full percentile uncertainty bands (P5–P95).
Self-contained Python plotting scripts are included to reproduce all figures and to re-scale the profiles to user-defined fleet sizes or energy totals.

---

## Repository Structure

```
open_access_package/
│
├── README.md                              ← This file
├── LICENSE                                ← MIT License (code) / CC-BY-4.0 (data)
├── .gitignore
│
│   ── Scripts ──
├── plot_normalized_profiles.py            ← Main plotting script (user-configurable scaling)
├── plot_demand_curves.py                  ← Legacy absolute-demand-curve plotting script
│
│   ── Normalised profiles (fraction of daily energy; sum = 1.0) ──
├── public_normalized_overall.csv
├── public_normalized_bat0-200.csv
├── public_normalized_bat200-300.csv
├── public_normalized_bat300-400.csv
├── public_normalized_bat400-500.csv
├── public_normalized_bat500-600.csv
├── depot_normalized_overall.csv
├── depot_normalized_bat0-200.csv
├── depot_normalized_bat200-300.csv
├── depot_normalized_bat300-400.csv
├── depot_normalized_bat400-500.csv
├── depot_normalized_bat500-600.csv
│
│   ── Scaled MW curves (simulation-default scaling) ──
├── public_scaled_MW_overall.csv
├── public_scaled_MW_bat0-200.csv
├── public_scaled_MW_bat200-300.csv
├── public_scaled_MW_bat300-400.csv
├── public_scaled_MW_bat400-500.csv
├── public_scaled_MW_bat500-600.csv
├── depot_scaled_MW_overall.csv
├── depot_scaled_MW_bat0-200.csv
├── depot_scaled_MW_bat200-300.csv
├── depot_scaled_MW_bat300-400.csv
├── depot_scaled_MW_bat400-500.csv
├── depot_scaled_MW_bat500-600.csv
│
│   ── Absolute demand curves (kW, direct simulation output) ──
├── public_demand_curve.csv
├── depot_demand_curve.csv
│
│   ── Figures (generated by the scripts) ──
├── normalized_profiles.png
├── scaled_demand_curves.png
├── profiles_by_battery_size.png
├── demand_by_battery_size.png
└── probabilistic_demand_curves.png
```

---

## Usage Instructions

### Prerequisites

- **Python 3.8+**
- Required packages: `pandas`, `numpy`, `matplotlib`

### Installation and execution

```bash
# 1. Clone the repository
git clone https://github.com/<your-username>/<your-repo>.git
cd <your-repo>

# 2. Install dependencies
pip install pandas numpy matplotlib

# 3. Generate all figures from the bundled CSV data
python plot_normalized_profiles.py

# 4. (Optional) Generate only the absolute demand-curve figure
python plot_demand_curves.py
```

### Custom scaling

To scale the normalised profiles to your own scenario, edit the **USER CONFIGURATION** block at the top of `plot_normalized_profiles.py`:

```python
# Example: scale to a fleet of 5 000 fast-charging trucks
N_TRUCKS_PUBLIC = 5000

# Example: directly specify total daily depot energy
DAILY_ENERGY_DEPOT_MWh = 200.0
```

The conversion from a normalised profile to an absolute MW curve is:

```
MW_curve[h] = normalised_profile[h] × total_daily_energy_MWh
```

Since each time bin is exactly 1 hour, the fraction × MWh = MW (average power for that hour).

---

## Data Description

### 1. Normalised profiles (`*_normalized_*.csv`)

Reusable, fleet-size-independent profiles whose 24 hourly values sum to 1.0.

| Column | Type    | Description |
|--------|---------|-------------|
| `hour` | int     | Hour of day (0 = midnight, …, 23 = 11 pm) |
| `mean` | float   | Mean fraction of daily energy across 78 simulation iterations |
| `std`  | float   | Standard deviation across iterations |
| `p5`   | float   | 5th percentile |
| `p25`  | float   | 25th percentile |
| `p50`  | float   | 50th percentile (median) |
| `p75`  | float   | 75th percentile |
| `p95`  | float   | 95th percentile |

Files are provided for **overall** (all battery sizes combined) and per **battery-capacity bin** (0–200, 200–300, 300–400, 400–500, 500–600 kWh).

### 2. Scaled MW curves (`*_scaled_MW_*.csv`)

Pre-scaled versions of the normalised profiles using the simulation mean daily energy. These files contain both the normalised columns _and_ `_MW`-suffixed columns.

| Column      | Type  | Description |
|-------------|-------|-------------|
| `hour`      | int   | Hour of day (0–23) |
| `mean`      | float | Normalised fraction (same as above) |
| `mean_MW`   | float | Mean power demand in MW |
| `std_MW`    | float | Standard deviation of power demand in MW |
| `p5_MW` … `p95_MW` | float | Percentile power demand in MW |

### 3. Absolute demand curves (`*_demand_curve.csv`)

Direct simulation output with full distributional statistics in kW.

| Column    | Type  | Description |
|-----------|-------|-------------|
| `hour`    | int   | Hour of day (0–23) |
| `mean_kW` | float | Mean power demand (kW) across 78 iterations |
| `std_kW`  | float | Standard deviation (kW) |
| `p5_kW` … `p95_kW` | float | Percentile bands (kW) |
| `min_kW`  | float | Minimum across all iterations (kW) |
| `max_kW`  | float | Maximum across all iterations (kW) |

> **Note:** Because each bin is exactly one hour, the kW values are numerically equal to the hourly energy in kWh.

### Charging categories

| Category | Label   | Description |
|----------|---------|-------------|
| **Public** | `public_*` | En-route fast / opportunity charging — simulated within MATSim |
| **Depot**  | `depot_*`  | Overnight slow charging — optimised for peak shaving (see paper) |

---

## Simulation Statistics

### Fleet and energy summary

|  | Public (Fast) | Depot (Optimised) |
|--|---------------|-------------------|
| Usable iterations | 78 | 78 |
| Mean trucks per day | 1,894 | 756 |
| Mean energy per truck | 664.6 kWh | 187.2 kWh |
| **Mean daily energy** | **1,269.0 MWh** | **141.6 MWh** |

### Energy share by battery capacity

| Battery size (kWh) | Public charging | Depot charging |
|---------------------|-----------------|----------------|
| 0–200   | 0.1 % | 0.2 % |
| 200–300 | 1.9 % | 7.2 % |
| 300–400 | 20.6 % | 14.4 % |
| **400–500** | **48.7 %** | **39.2 %** |
| 500–600 | 28.8 % | 39.1 % |

---

## Methodology

### Transport simulation

The underlying model simulates freight truck operations across Sweden using
[MATSim](https://www.matsim.org/) with electric vehicle charging extensions.
Each iteration represents a complete day of operations with stochastic route and schedule variation.

- **83 total iterations** simulated; **iterations 5–9 excluded** (known errors) → **78 usable**.
- **≈ 6,200 electric trucks** modelled nationally.
- Coordinate reference system: SWEREF 99 TM (EPSG:3006).
- Geographic scope of these profiles: **Skåne** (Scania), southern Sweden.

### Public (fast) charging

Trucks autonomously decide when and where to charge based on state-of-charge and route.
Per-event energy is distributed across 1-hour bins proportional to charging duration (constant-power assumption), then aggregated across all Skåne stations.

### Depot (optimised) charging

End-of-day charging is scheduled via peak-shaving optimisation (LP) that minimises peak grid demand while ensuring each truck reaches a target SOC of 80–100 %.
The optimisation runs per depot with 5-minute time slots and a maximum of 350 kW per vehicle.
The resulting very flat depot profile (peak-to-valley ratio ≈ 1.04) demonstrates effective load flattening.

### Normalisation procedure

For each iteration and battery-size category:
1. Build a 24-hour energy profile (kWh per hour).
2. Divide by the iteration's daily total → fraction profile summing to 1.0.
3. Compute percentile statistics (mean, P5–P95) across all 78 iterations.

This separates the *temporal shape* of charging demand from the *magnitude*, allowing the profiles to be scaled to any fleet scenario.

---

## Citation

If you use this dataset or code, please cite:

> **[Your Paper Title]**, *Authors*, Lund University, 2026.
> Published in: *[Journal / Conference]*.
> DOI: [https://doi.org/10.XXXX/XXXXX](https://doi.org/10.XXXX/XXXXX)

Zenodo archive:

> [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.XXXXXXX.svg)](https://doi.org/10.5281/zenodo.XXXXXXX)

```bibtex
@article{YourCiteKey2026,
  author    = {Author, A. and Author, B.},
  title     = {Your Paper Title},
  journal   = {Journal Name},
  year      = {2026},
  doi       = {10.XXXX/XXXXX},
  note      = {Lund University}
}

@software{YourCiteKey2026_code,
  author    = {Author, A. and Author, B.},
  title     = {Station-Level Charging Demand Profiles for Heavy-Duty Electric Trucks},
  year      = {2026},
  publisher = {Zenodo},
  doi       = {10.5281/zenodo.XXXXXXX},
  url       = {https://doi.org/10.5281/zenodo.XXXXXXX}
}
```

---

## License

| Component | License |
|-----------|---------|
| **Code** (Python scripts) | [MIT License](LICENSE) |
| **Data** (CSV files) | [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/) |

---

## Contact

For questions or collaboration enquiries, please open an issue on this repository or contact the authors at Lund University.
